<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitting monotone GAM models with monogamy • monogamy</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fitting monotone GAM models with monogamy">
<meta property="og:description" content="monogamy">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">monogamy</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/monotonic-gam-models.html">Fitting monotone GAM models with monogamy</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/gzt/monogamy/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fitting monotone GAM models with monogamy</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gzt/monogamy/blob/master/vignettes/monotonic-gam-models.Rmd"><code>vignettes/monotonic-gam-models.Rmd</code></a></small>
      <div class="hidden name"><code>monotonic-gam-models.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="no">monogamy</span>)
<span class="co">#&gt; Loading required package: monogamy</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">mgcv</span>)
<span class="co">#&gt; Loading required package: nlme</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'nlme'</span>
<span class="co">#&gt; The following object is masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     collapse</span>
<span class="co">#&gt; This is mgcv 1.8-31. For overview type 'help("mgcv-package")'.</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">purrr</span>)</pre></body></html></div>
<div id="basic-model-fitting" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-model-fitting" class="anchor"></a>Basic Model Fitting</h2>
<p>This example from the <code>mgcv</code> package demonstrates fitting a monotonic GAM model with two different settings for the <code>k</code> parameter.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">20200410</span>)
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="fl">100</span>) * <span class="fl">4</span> - <span class="fl">1</span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">x</span>)
<span class="no">f</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fl">4</span> * <span class="no">x</span>) / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fl">4</span> * <span class="no">x</span>))
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="no">f</span> + <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">100</span>) * <span class="fl">0.1</span>
<span class="co">#par(mfrow = c(1, 2))</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">x</span>, <span class="no">y</span>)
<span class="no">fv</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mspline.html">mspline</a></span>(<span class="no">x</span>, <span class="no">y</span>, <span class="fl">5</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">x</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">fv</span>, <span class="no">x</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="st">"#7fc97f"</span>)
<span class="no">residfv_5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span>(<span class="no">fv</span>)
<span class="no">fv</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mspline.html">mspline</a></span>(<span class="no">x</span>, <span class="no">y</span>, <span class="fl">10</span>)
 <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">x</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">fv</span>, <span class="no">x</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="st">"#386cb0"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"bottomright"</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"k="</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>, <span class="fl">10</span>)),
       <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#7fc97f"</span>, <span class="st">"#386cb0"</span>))</pre></body></html></div>
<p><img src="monotonic-gam-models_files/figure-html/plotfunction-1.png" width="576"></p>
<div class="sourceCode" id="cb3"><html><body><pre class="r">
<span class="no">residfv_10</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span>(<span class="no">fv</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">residfv_5</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Residuals vs x plot"</span>,
     <span class="kw">col</span> <span class="kw">=</span> <span class="st">"#7fc97f"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"residual"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">residfv_10</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"#386cb0"</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">16</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"bottomright"</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">16</span>), <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"k="</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>, <span class="fl">10</span>)),
       <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#7fc97f"</span>, <span class="st">"#386cb0"</span>))</pre></body></html></div>
<p><img src="monotonic-gam-models_files/figure-html/plotfunction-2.png" width="576"></p>
<p>This is an artificial data set, though, and the ground truth is that the curve is monotonic. Here we present some real data where the relationships between the variables are expected to be monotonic but may not be.</p>
</div>
<div id="application-to-image-comparison-data" class="section level2">
<h2 class="hasAnchor">
<a href="#application-to-image-comparison-data" class="anchor"></a>Application to Image Comparison Data</h2>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">imagemetrics</span>)
<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">imagemetrics</span>), <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">base_img</th>
<th align="right">img_no</th>
<th align="left">base_name</th>
<th align="left">distorted</th>
<th align="right">mean</th>
<th align="right">std</th>
<th align="left">metric</th>
<th align="right">score</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">image-1.png</td>
<td align="left">image-1-1.png</td>
<td align="right">62.364</td>
<td align="right">18.266</td>
<td align="left">catsim</td>
<td align="right">0.692</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">image-1.png</td>
<td align="left">image-1-2.png</td>
<td align="right">62.778</td>
<td align="right">23.826</td>
<td align="left">catsim</td>
<td align="right">0.644</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">3</td>
<td align="left">image-1.png</td>
<td align="left">image-1-3.png</td>
<td align="right">29.214</td>
<td align="right">20.719</td>
<td align="left">catsim</td>
<td align="right">0.188</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">4</td>
<td align="left">image-1.png</td>
<td align="left">image-1-4.png</td>
<td align="right">25.400</td>
<td align="right">15.848</td>
<td align="left">catsim</td>
<td align="right">0.115</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">5</td>
<td align="left">image-1.png</td>
<td align="left">image-1-5.png</td>
<td align="right">66.188</td>
<td align="right">26.100</td>
<td align="left">catsim</td>
<td align="right">0.909</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">6</td>
<td align="left">image-1.png</td>
<td align="left">image-1-6.png</td>
<td align="right">47.300</td>
<td align="right">22.818</td>
<td align="left">catsim</td>
<td align="right">0.801</td>
</tr>
</tbody>
</table>
<p>Here we have, in long format, a set of image quality metrics for a set of 180 distorted binary images. There are 12 “ground truth” images and 15 distorted versions of them. A number of people were surveyed for their opinion of the quality of the distorted images compared to the baseline on a scale from 0 - 100. The mean for each image is in the column <code>mean</code> - designated the ‘Mean Opinion Score’ or MOS - and the standard deviation of their rating is captured in the column <code>std</code>. We then compute a set of image quality metrics whose scores are in ‘score’ and whose names are in ‘metric’.</p>
<p><img src="image-1.png" title="Baseline Image #1" alt="Baseline Image #1"><img src="image-1-8.png" title="Distorted Image #1-8" alt="Distorted Image #1-8"></p>
<p>Here are two example images the respondents would have been shown: the baseline image on the left and the distorted image on the right. This image had a mean rating of 52.</p>
<p>We expect there to be a correspondence between the image quality metrics and the MOS and that it should be monotonic, though it may be curved and may have a lot of noise in it. The quality of the images is very low compared to what might be typical for full color or grayscale images.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">metric_names</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
  <span class="kw">`catsim`</span> <span class="kw">=</span> <span class="st">"CatSIM (Cohen)"</span>,
  <span class="kw">`msssim`</span> <span class="kw">=</span> <span class="st">"MS-SSIM"</span>,
  <span class="kw">`AdjRand`</span> <span class="kw">=</span> <span class="st">"Adjusted Rand"</span>,
  <span class="kw">`catsimrand`</span> <span class="kw">=</span> <span class="st">"CatSIM (AdjRand)"</span>,
  <span class="kw">`catsimacc`</span> <span class="kw">=</span> <span class="st">"CatSIM (Accuracy)"</span>,
  <span class="kw">`accuracy`</span> <span class="kw">=</span> <span class="st">"Accuracy"</span>,
  <span class="kw">`cwssim`</span> <span class="kw">=</span> <span class="st">"CW-SSIM"</span>,
  <span class="kw">`Cohen`</span> <span class="kw">=</span> <span class="st">"Cohen's kappa"</span>
)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">qplot</a></span>(
  <span class="kw">x</span> <span class="kw">=</span> <span class="no">score</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">mean</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="st">"#b2df8a"</span>), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="fl">0.8</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="fl">0.75</span>),
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">imagemetrics</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span>(
    <span class="kw">method</span> <span class="kw">=</span> <span class="st">"gam"</span>, <span class="kw">se</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"#1f78b4"</span>,
    <span class="kw">method.args</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"GCV.Cp"</span>)
    ) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span>(<span class="kw">method</span><span class="kw">=</span><span class="st">"lm"</span>, <span class="kw">se</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"#fb9a99"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"MOS"</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="kw">NULL</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">metric</span>, <span class="kw">labeller</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller</a></span>(<span class="no">metric_names</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(
    <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/reexports.html">alpha</a></span>(<span class="st">"#a6cee3"</span>, <span class="fl">0.3</span>)),
    <span class="kw">axis.text.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">angle</span> <span class="kw">=</span> <span class="fl">45</span>, <span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">1</span>)
  ) +
    <span class="kw">NULL</span>
<span class="co">#&gt; `geom_smooth()` using formula 'y ~ s(x, bs = "cs")'</span>
<span class="co">#&gt; `geom_smooth()` using formula 'y ~ x'</span></pre></body></html></div>
<p><img src="monotonic-gam-models_files/figure-html/plotmetrics-1.png" width="576"></p>
<p>There is a GAM model on the plot and it’s fitted by generalized cross validation, but it has a problem: the fit really ought to be monotonic, though it’s interesting if it isn’t. We should have some sense of how well a monotonic fit works for this data and then can judge which metric best explains the variation in MOS. We can get a sense of how well each method relates to the MOS rating by looking at their correlatiosn:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">groupcorr</span> <span class="kw">&lt;-</span> <span class="no">imagemetrics</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">metric</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="kw">Spearman</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">mean</span>,<span class="no">score</span>, <span class="kw">method</span><span class="kw">=</span><span class="st">"spearman"</span>, <span class="kw">use</span> <span class="kw">=</span> <span class="st">"complete.obs"</span>),
              <span class="kw">Kendall</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">mean</span>, <span class="no">score</span>, <span class="kw">method</span><span class="kw">=</span><span class="st">"kendall"</span>, <span class="kw">use</span> <span class="kw">=</span> <span class="st">"complete.obs"</span>),
              <span class="kw">Pearson</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">mean</span>, <span class="no">score</span>, <span class="kw">method</span><span class="kw">=</span><span class="st">"pearson"</span>, <span class="kw">use</span> <span class="kw">=</span> <span class="st">"complete.obs"</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">Spearman</span>)

<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="no">groupcorr</span>,<span class="kw">digits</span><span class="kw">=</span><span class="fl">3</span>)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">metric</th>
<th align="right">Spearman</th>
<th align="right">Kendall</th>
<th align="right">Pearson</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">cwssim</td>
<td align="right">0.439</td>
<td align="right">0.308</td>
<td align="right">0.510</td>
</tr>
<tr class="even">
<td align="left">accuracy</td>
<td align="right">0.503</td>
<td align="right">0.362</td>
<td align="right">0.500</td>
</tr>
<tr class="odd">
<td align="left">Cohen</td>
<td align="right">0.523</td>
<td align="right">0.362</td>
<td align="right">0.577</td>
</tr>
<tr class="even">
<td align="left">AdjRand</td>
<td align="right">0.559</td>
<td align="right">0.393</td>
<td align="right">0.557</td>
</tr>
<tr class="odd">
<td align="left">catsim</td>
<td align="right">0.560</td>
<td align="right">0.391</td>
<td align="right">0.597</td>
</tr>
<tr class="even">
<td align="left">catsimacc</td>
<td align="right">0.561</td>
<td align="right">0.400</td>
<td align="right">0.601</td>
</tr>
<tr class="odd">
<td align="left">catsimrand</td>
<td align="right">0.578</td>
<td align="right">0.413</td>
<td align="right">0.581</td>
</tr>
<tr class="even">
<td align="left">msssim</td>
<td align="right">0.598</td>
<td align="right">0.425</td>
<td align="right">0.578</td>
</tr>
</tbody>
</table>
<p>A non-parametric correlation such as Spearman’s, since we want a monotonic relationship, says more about the correspondence of the metrics to the MOS in the way that we are interested in. However, we are probably interested in a flexible model explaining their relationship, so here we fit a monotonic GAM with <code>k = 10</code> and compare the deviance explained by the model to an unconstrained GAM with the same parameters.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">fit_mspline</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">df</span>, <span class="no">k</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="no">lower</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="no">upper</span> <span class="kw">=</span> <span class="fl">NA</span>) {
    <span class="fu"><a href="../reference/mspline.html">mspline</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">df</span><span class="kw">[[</span><span class="st">"score"</span>]], <span class="kw">y</span> <span class="kw">=</span> <span class="no">df</span><span class="kw">[[</span><span class="st">"mean"</span>]],
            <span class="kw">k</span> <span class="kw">=</span> <span class="no">k</span>, <span class="kw">lower</span> <span class="kw">=</span> <span class="no">lower</span>, <span class="kw">upper</span> <span class="kw">=</span> <span class="no">upper</span>)
}

<span class="no">fit_mgcv</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">df</span>, <span class="no">k</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="no">...</span>) {
     <span class="no">x</span> <span class="kw">&lt;-</span> <span class="no">df</span><span class="kw">[[</span><span class="st">"score"</span>]]
     <span class="no">y</span> <span class="kw">&lt;-</span> <span class="no">df</span><span class="kw">[[</span><span class="st">"mean"</span>]]
     <span class="no">pass_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>)
    <span class="kw pkg">mgcv</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span>(<span class="no">y</span> ~ <span class="fl">1</span>+ <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span>(<span class="no">x</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="no">k</span>, <span class="kw">bs</span> <span class="kw">=</span> <span class="st">"cr"</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">pass_df</span>,<span class="no">...</span>)
}

<span class="no">metricnames</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CatSIM (Cohen)"</span>,
                 <span class="st">"CatSIM (AdjRand)"</span>,
                 <span class="st">"Adjusted Rand"</span>,
                 <span class="st">"Cohen's kappa"</span>,
                 <span class="st">"MS-SSIM"</span>,
                 <span class="st">"CatSIM (Accuracy)"</span>,
                 <span class="st">"Accuracy"</span>,
                 <span class="st">"CW-SSIM"</span>)
<span class="no">varMOS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">imagemetrics</span>$<span class="no">mean</span>[<span class="no">imagemetrics</span>$<span class="no">metric</span> <span class="kw">==</span> <span class="st">"msssim"</span>])

<span class="no">imagemetrics</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">metric</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">msplinemodel</span> <span class="kw">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="no">data</span>, <span class="no">fit_mspline</span>),
           <span class="kw">residuals</span> <span class="kw">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="no">msplinemodel</span>, <span class="no">residuals</span>),
           <span class="kw">msplineVAR</span> <span class="kw">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(<span class="no">residuals</span>, <span class="no">var</span>),
           <span class="kw">msplineDevExp</span> <span class="kw">=</span> <span class="fl">1</span> - <span class="no">msplineVAR</span>/<span class="no">varMOS</span>,
           <span class="kw">mgcvmodel</span> <span class="kw">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="no">data</span>, <span class="fu"><a href="https://purrr.tidyverse.org/reference/safely.html">possibly</a></span>(<span class="no">fit_mgcv</span>, <span class="kw">otherwise</span> <span class="kw">=</span> <span class="fl">NA</span>)),
           <span class="kw">mgcvDevExp</span> <span class="kw">=</span> <span class="fl">1</span> - <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(<span class="no">mgcvmodel</span>, ~<span class="no">.x</span>$<span class="no">deviance</span>/<span class="no">.x</span>$<span class="no">null.deviance</span>)) <span class="kw">-&gt;</span>
    <span class="no">metricmodels</span>
<span class="no">metricmodels</span>$<span class="no">label</span> <span class="kw">&lt;-</span> <span class="no">metricnames</span>

<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">metricmodels</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>() <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">label</span>, <span class="no">mgcvDevExp</span>, <span class="no">msplineDevExp</span>),
             <span class="kw">col.names</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Metric"</span>, <span class="st">"GAM % Deviance"</span>, <span class="st">"mono-GAM % Deviance"</span>),
             <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">Metric</th>
<th align="right">GAM % Deviance</th>
<th align="right">mono-GAM % Deviance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CatSIM (Cohen)</td>
<td align="right">0.368</td>
<td align="right">0.368</td>
</tr>
<tr class="even">
<td align="left">CatSIM (AdjRand)</td>
<td align="right">0.380</td>
<td align="right">0.380</td>
</tr>
<tr class="odd">
<td align="left">Adjusted Rand</td>
<td align="right">0.420</td>
<td align="right">0.375</td>
</tr>
<tr class="even">
<td align="left">Cohen’s kappa</td>
<td align="right">0.414</td>
<td align="right">0.401</td>
</tr>
<tr class="odd">
<td align="left">MS-SSIM</td>
<td align="right">0.403</td>
<td align="right">0.377</td>
</tr>
<tr class="even">
<td align="left">CatSIM (Accuracy)</td>
<td align="right">0.391</td>
<td align="right">0.386</td>
</tr>
<tr class="odd">
<td align="left">Accuracy</td>
<td align="right">0.407</td>
<td align="right">0.336</td>
</tr>
<tr class="even">
<td align="left">CW-SSIM</td>
<td align="right">0.313</td>
<td align="right">0.313</td>
</tr>
</tbody>
</table>
<p>For most of the models, there is not much difference between the fit of the monotonic GAM and the unconstrained GAM. A discrepancy between the two indicates there is some region where the image quality metric</p>
</div>
<div id="plotting-the-monotonic-gam" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-the-monotonic-gam" class="anchor"></a>Plotting the monotonic GAM</h2>
<p>We can plot the monotonic GAMs and unconstrained GAMs for each metric here:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>))
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">8</span>) {
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">metricmodels</span>$<span class="no">msplinemodel</span><span class="kw">[[</span><span class="no">i</span>]], <span class="kw">xlab</span> <span class="kw">=</span> <span class="no">metricmodels</span>$<span class="no">label</span>[<span class="no">i</span>],
         <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"MOS"</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">16</span>, <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">100</span>))
    <span class="no">mgcvx</span> <span class="kw">&lt;-</span> <span class="no">metricmodels</span>$<span class="no">mgcvmodel</span><span class="kw">[[</span><span class="no">i</span>]]$<span class="no">model</span>$<span class="no">x</span>
    <span class="no">mgcvy</span> <span class="kw">&lt;-</span> <span class="no">metricmodels</span>$<span class="no">mgcvmodel</span><span class="kw">[[</span><span class="no">i</span>]]$<span class="no">fitted.values</span>
    <span class="no">rearr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span>(<span class="no">mgcvx</span>)
    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">mgcvx</span>[<span class="no">rearr</span>], <span class="no">mgcvy</span>[<span class="no">rearr</span>], <span class="kw">col</span> <span class="kw">=</span> <span class="st">"blue"</span>)
    <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"bottomright"</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Mono"</span>, <span class="st">"Uncons"</span>),
           <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"red"</span>, <span class="st">"blue"</span>))
}</pre></body></html></div>
<p><img src="monotonic-gam-models_files/figure-html/monogamyplots-1.png" width="768"><img src="monotonic-gam-models_files/figure-html/monogamyplots-2.png" width="768"><img src="monotonic-gam-models_files/figure-html/monogamyplots-3.png" width="768"><img src="monotonic-gam-models_files/figure-html/monogamyplots-4.png" width="768"></p>
</div>
<div id="unconstrained-gam-diagnostics" class="section level2">
<h2 class="hasAnchor">
<a href="#unconstrained-gam-diagnostics" class="anchor"></a>Unconstrained GAM diagnostics</h2>
<div class="sourceCode" id="cb9"><html><body><pre class="r">
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">8</span>)
    <span class="kw pkg">mgcv</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.check.html">gam.check</a></span>(<span class="no">metricmodels</span>$<span class="no">mgcvmodel</span><span class="kw">[[</span><span class="no">i</span>]])</pre></body></html></div>
<p><img src="monotonic-gam-models_files/figure-html/unrestrictedGAMplot-1.png" width="576"></p>
<pre><code>#&gt; 
#&gt; Method: GCV   Optimizer: magic
#&gt; Smoothing parameter selection converged after 11 iterations.
#&gt; The RMS GCV score gradient at convergence was 0.001174777 .
#&gt; The Hessian was positive definite.
#&gt; Model rank =  10 / 10 
#&gt; 
#&gt; Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
#&gt; indicate that k is too low, especially if edf is close to k'.
#&gt; 
#&gt;        k'  edf k-index p-value  
#&gt; s(x) 9.00 1.75     0.9    0.07 .
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p><img src="monotonic-gam-models_files/figure-html/unrestrictedGAMplot-2.png" width="576"></p>
<pre><code>#&gt; 
#&gt; Method: GCV   Optimizer: magic
#&gt; Smoothing parameter selection converged after 6 iterations.
#&gt; The RMS GCV score gradient at convergence was 9.379305e-05 .
#&gt; The Hessian was positive definite.
#&gt; Model rank =  10 / 10 
#&gt; 
#&gt; Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
#&gt; indicate that k is too low, especially if edf is close to k'.
#&gt; 
#&gt;        k'  edf k-index p-value
#&gt; s(x) 9.00 2.88    0.97    0.28</code></pre>
<p><img src="monotonic-gam-models_files/figure-html/unrestrictedGAMplot-3.png" width="576"></p>
<pre><code>#&gt; 
#&gt; Method: GCV   Optimizer: magic
#&gt; Smoothing parameter selection converged after 7 iterations.
#&gt; The RMS GCV score gradient at convergence was 0.0002361563 .
#&gt; The Hessian was positive definite.
#&gt; Model rank =  10 / 10 
#&gt; 
#&gt; Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
#&gt; indicate that k is too low, especially if edf is close to k'.
#&gt; 
#&gt;        k'  edf k-index p-value
#&gt; s(x) 9.00 8.46    1.02    0.62</code></pre>
<p><img src="monotonic-gam-models_files/figure-html/unrestrictedGAMplot-4.png" width="576"></p>
<pre><code>#&gt; 
#&gt; Method: GCV   Optimizer: magic
#&gt; Smoothing parameter selection converged after 4 iterations.
#&gt; The RMS GCV score gradient at convergence was 0.0001063709 .
#&gt; The Hessian was positive definite.
#&gt; Model rank =  10 / 10 
#&gt; 
#&gt; Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
#&gt; indicate that k is too low, especially if edf is close to k'.
#&gt; 
#&gt;       k' edf k-index p-value  
#&gt; s(x) 9.0 6.3    0.89   0.075 .
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p><img src="monotonic-gam-models_files/figure-html/unrestrictedGAMplot-5.png" width="576"></p>
<pre><code>#&gt; 
#&gt; Method: GCV   Optimizer: magic
#&gt; Smoothing parameter selection converged after 4 iterations.
#&gt; The RMS GCV score gradient at convergence was 4.601358e-07 .
#&gt; The Hessian was positive definite.
#&gt; Model rank =  10 / 10 
#&gt; 
#&gt; Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
#&gt; indicate that k is too low, especially if edf is close to k'.
#&gt; 
#&gt;        k'  edf k-index p-value
#&gt; s(x) 9.00 6.53    1.04    0.63</code></pre>
<p><img src="monotonic-gam-models_files/figure-html/unrestrictedGAMplot-6.png" width="576"></p>
<pre><code>#&gt; 
#&gt; Method: GCV   Optimizer: magic
#&gt; Smoothing parameter selection converged after 5 iterations.
#&gt; The RMS GCV score gradient at convergence was 1.373513e-05 .
#&gt; The Hessian was positive definite.
#&gt; Model rank =  10 / 10 
#&gt; 
#&gt; Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
#&gt; indicate that k is too low, especially if edf is close to k'.
#&gt; 
#&gt;        k'  edf k-index p-value
#&gt; s(x) 9.00 5.05    0.96    0.33</code></pre>
<p><img src="monotonic-gam-models_files/figure-html/unrestrictedGAMplot-7.png" width="576"></p>
<pre><code>#&gt; 
#&gt; Method: GCV   Optimizer: magic
#&gt; Smoothing parameter selection converged after 4 iterations.
#&gt; The RMS GCV score gradient at convergence was 6.456566e-05 .
#&gt; The Hessian was positive definite.
#&gt; Model rank =  10 / 10 
#&gt; 
#&gt; Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
#&gt; indicate that k is too low, especially if edf is close to k'.
#&gt; 
#&gt;        k'  edf k-index p-value
#&gt; s(x) 9.00 6.65    0.97    0.29</code></pre>
<p><img src="monotonic-gam-models_files/figure-html/unrestrictedGAMplot-8.png" width="576"></p>
<pre><code>#&gt; 
#&gt; Method: GCV   Optimizer: magic
#&gt; Smoothing parameter selection converged after 7 iterations.
#&gt; The RMS GCV score gradient at convergence was 0.0001074716 .
#&gt; The Hessian was positive definite.
#&gt; Model rank =  10 / 10 
#&gt; 
#&gt; Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
#&gt; indicate that k is too low, especially if edf is close to k'.
#&gt; 
#&gt;        k'  edf k-index p-value
#&gt; s(x) 9.00 3.53    1.01    0.55</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Geoffrey Thompson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
